{% block metadata %}---
feature: {{ service_name }}
domain: {{ domain or 'Backend' }}
layer: Service
component: {{ service_name }}
status: deployed
version: {{ version or '1.0' }}
componentType: Service
priority: P1
lastUpdated: {{ last_updated }}
---
{% endblock %}

{% block title %}# Service: {{ service_name }}{% endblock %}

{% block service_info %}**Namespace/Project**: {{ namespace or 'Not specified' }}  
**File Location**: Multiple source files  
**Complexity**: Medium  
**Documentation Level**: ğŸ”¶ Baseline (70% complete)

---
{% endblock %}

{% block quick_reference %}## Quick Reference (TL;DR)

**What it does:**  
{{ service_summary or 'ğŸ¤– [AI: 1-2 sentences on what service accomplishes]' }}

**When to use it:**  
â“ [HUMAN: What scenarios trigger use of this service? Web UI? API? Background jobs?]

**Watch out for:**  
â“ [HUMAN: Critical gotcha or common mistake when using this service]

---
{% endblock %}

{% block what_and_why %}## What & Why

### Purpose

**Technical:** 
{{ service_summary or 'ğŸ¤– [AI: Technical description of what service does]' }}

**Business:** 
â“ [HUMAN: Business purpose - what problem does this solve?]

### Capabilities

{% if capabilities %}
The service provides the following core capabilities:
{% for cap in capabilities %}
- {{ cap }}
{% endfor %}
{% else %}
ğŸ¤– [AI: Bullet list of what service can do]
{% endif %}

### Use Cases

{% if use_cases and use_cases | length > 0 %}
{# PHASE 9: Render actual extracted use cases #}
{% for use_case in use_cases %}
**{{ use_case.title }}**
- **Who**: {{ use_case.actor }}
- **What**: {{ use_case.description }}
- **Preconditions**: {{ use_case.preconditions | join(', ') }}
- **Steps**:
  {% for step in use_case.steps %}
  {{ loop.index }}. {{ step }}
  {% endfor %}
- **Result**: {{ use_case.postconditions | join(', ') }}

{% endfor %}
{% else %}
â“ [HUMAN: Document common scenarios and use cases]
{% endif %}

### Not Responsible For

â“ [HUMAN: What this service explicitly does NOT do]

**Example:**
- Does NOT enforce prerequisites (handled by EnrollmentService)
- Does NOT manage authentication (handled by AuthService)
- Does NOT manage course content (content platform responsibility)

---
{% endblock %}

{% block how_it_works %}## How It Works

{% if primary_method %}
### Primary Operation: {{ primary_method.name }}

**Purpose:**  
ğŸ¤– [AI: What this method accomplishes]  
â“ [HUMAN: Business context - why do we need this operation?]

**Input:**  
{% if primary_method.parameters %}
```csharp
{% for param in primary_method.parameters %}
{{ param.type }} {{ param.name }}{% if param.default %} = {{ param.default }}{% endif %}  // {% if param.description %}{{ param.description }}{% else %}Parameter{% endif %}
{% endfor %}
```
{% else %}
No parameters
{% endif %}

**Output:**  
{% if primary_method.return_type %}
`{{ primary_method.return_type }}`
{% else %}
No return value
{% endif %}

**Step-by-Step Flow:**

{% if operation_flows and operation_flows | length > 0 %}
{# PHASE 8: Render actual extracted operation flow #}
{% set flow = operation_flows | first %}
```
{{ flow.ascii_diagram }}
```

**Success Path:**  
{{ flow.success_path }}

**Failure Paths:**
{% for step in flow.steps %}
{% if step.error_path %}
- **{{ step.description }} fails**: {{ step.error_path }}
{% endif %}
{% endfor %}
{% else %}
{# Placeholder flow diagram for manual completion #}
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Validate Inputs                                      â”‚
â”‚  What  â†’ Check parameters and business rules                 â”‚
â”‚  Why   â†’ Ensure request is valid before processing           â”‚
â”‚  Error â†’ Invalid parameters â†’ 400 BadRequest                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Query Requirements                                   â”‚
â”‚  What  â†’ Fetch dependent data from repositories              â”‚
â”‚  Why   â†’ Verify prerequisites are met                        â”‚
â”‚  Error â†’ Data not found â†’ 404 NotFound                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Execute Business Logic                               â”‚
â”‚  What  â†’ Apply domain rules and transformations              â”‚
â”‚  Why   â†’ Enforce business constraints                        â”‚
â”‚  Error â†’ Rule violation â†’ 409 Conflict                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Persist Results                                      â”‚
â”‚  What  â†’ Save changes to database                            â”‚
â”‚  Why   â†’ Make changes durable                                â”‚
â”‚  Error â†’ Database failure â†’ 500 InternalServerError          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    [SUCCESS - Operation Complete]
```

**Success Path:**  
Operation completes successfully and data is persisted.

**Failure Paths:**
- **Validation fails**: Returns error response with validation details
- **Prerequisites not met**: Returns 404 or conflict response
- **Business rule violation**: Returns 409 Conflict or specific error code
- **Database error**: Returns 500 server error
{% endif %}

{% else %}
ğŸ¤– [AI: Provide a step-by-step explanation of the service's main workflows]

### Primary Workflow
1. User submits a request
2. System validates the request against business rules
3. Service queries database for related data
4. If successful, applies business logic and performs data mutation
5. Returns result to caller
{% endif %}

---
{% endblock %}

{% block business_rules %}## Business Rules

{% if enhanced_business_rules and enhanced_business_rules | length > 0 %}
{# PHASE 10.1: Render business rules in table format #}
| Description | Type | Example | Violation Consequence |
|-------------|------|---------|----------------------|
{% for rule in enhanced_business_rules %}
| {{ rule.description }} | {{ rule.rule_type }} | {% if rule.example %}{{ rule.example }}{% else %}N/A{% endif %} | {% if rule.violation_consequence %}{{ rule.violation_consequence }}{% else %}N/A{% endif %} |
{% endfor %}

{% elif business_rules %}
| Rule ID | Description | Why It Exists | Enforced By |
|---------|-------------|---------------|------------|
{% for rule in business_rules %}
| {{ rule.title or 'BR-' ~ loop.index }} | {{ rule.description }} | {% if rule.related_code %}[See Code]({{ rule.related_code }}){% else %}[HUMAN: Enter rationale]{% endif %} | Service logic |
{% endfor %}
{% else %}
ğŸ¤– [AI: Document business logic, constraints, and invariants that this service maintains]
- Example: "Course enrollments are limited to 30 students per section"
- Example: "A course must have at least one instructor assigned before it can be published"
- Example: "Once published, a course description cannot be changed"
{% endif %}

**Common Questions:**  
{% if faq_items and faq_items | length > 0 %}
{# PHASE 9: Render actual extracted FAQ items #}
{% for category, items in faq_items | groupby('category') %}

### {{ category }}
{% for faq in items %}
**â“ {{ faq.question }}**  
{{ faq.answer }}

{% endfor %}
{% endfor %}
{% else %}
â“ [HUMAN: Add FAQ section with edge cases and clarifications]
{% endif %}

---
{% endblock %}

{% block architecture %}## Architecture

### Where This Fits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Layer                                               â”‚
â”‚   [Controller]                                            â”‚
â”‚   â†’ Handles HTTP requests/responses                       â”‚
â”‚   â†’ Routes to service methods                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â–º {{ service_name }} â—„        (THIS SERVICE)            â”‚
â”‚   (Business Logic & Domain Operations)                    â”‚
â”‚   â†’ Enforces business rules                               â”‚
â”‚   â†’ Manages domain operations                             â”‚
â”‚   â†’ Coordinates with repositories                         â”‚
â”‚   â†’ Maps domain â†’ DTOs                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Layer                                              â”‚
â”‚   [Repository Interfaces]                                â”‚
â”‚   â†’ CRUD operations on entities                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dependencies (What This Service Needs)

{% if dependencies %}
| Dependency | Type | Purpose | Failure Impact |
|-----------|------|---------|-----------------|
{% for dep in dependencies %}
| `{{ dep.name }}` | {{ dep.type }} | {{ dep.purpose }} | {% if dep.failure_impact %}{{ dep.failure_impact | truncate(80) }}{% else %}âš ï¸ Critical{% endif %} |
{% endfor %}
{% else %}
| Dependency | Type | Purpose | Critical? |
|-----------|------|---------|-----------|
| `[Dependency]` | `[Type]` | ğŸ¤– [AI: What is it used for] | No |
{% endif %}

### Consumers (Who Uses This Service)

| Consumer | Use Case | Impact of Failure |
|----------|----------|-------------------|
| `[Controller]` | HTTP endpoints for CRUD operations | Users cannot perform operations; 500 error response |
| `[Other Service]` | References this service for domain logic | Dependent service unavailable |

---
{% endblock %}

{% block endpoints %}## API Contract (AI Context)

> ğŸ“‹ **Interactive Documentation:** See source files for latest endpoint definitions  
> **Sync Status:** Last verified on {{ last_updated }}

### Endpoints

{% if endpoints %}
| Method | Route | Purpose | Auth Required |
|--------|-------|---------|-----------------|
{% for endpoint in endpoints %}
| `{{ endpoint.method }}` | `{{ endpoint.path }}` | {{ endpoint.summary or endpoint.method ~ ' ' ~ endpoint.path }} | âœ… Yes |
{% endfor %}
{% else %}
| Method | Route | Purpose | Auth |
|--------|-------|---------|------|
| ğŸ¤– `GET` | ğŸ¤– `/api/[endpoint]` | ğŸ¤– Purpose | âœ… Yes |
{% endif %}

### Request Example

{% if request_response_examples and request_response_examples | length > 0 %}
{% set first_example = request_response_examples.values() | list | first %}
```json
{{ first_example.json | tojson(indent=2) }}
```

{% if first_example.properties %}
**Properties:**

| Property | Type | Required | Description |
|----------|------|----------|-------------|
{% for prop in first_example.properties %}
| `{{ prop.name }}` | `{{ prop.type }}` | {% if prop.required %}âœ… Yes{% else %}âŒ No{% endif %} | ğŸ¤– Purpose |
{% endfor %}
{% endif %}
{% else %}
```json
{
  "ğŸ¤–": "[AI: Extract from DTO definition]",
  "â“": "[HUMAN: Update with actual example]"
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `property` | `type` | âœ… Yes | ğŸ¤– [AI: Purpose from DTO] |
{% endif %}

### Success Response Example (200 OK)

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Operation completed successfully"
}
```

### Error Response Example (409 Conflict)

```json
{
  "traceId": "0HN1GLDM8VJ8P:00000001",
  "message": "â“ [HUMAN: Document common error case]"
}
```

---
{% endblock %}

{% block validation_rules %}## Validation Rules (AUTO-GENERATED)

{% if validation_rules %}
| Property | Rule | Error Message |
|----------|------|---------------|
{% for rule in validation_rules %}
| `{{ rule.property }}` | `{{ rule.rule_type }}` | {{ rule.error_message }} |
{% endfor %}
{% else %}
ğŸ¤– [AI: Document input validation rules - what fields are validated, how, and what error messages are shown]

| Property | Rule | Error Message |
|----------|------|---------------|
| `[field]` | `NotEmpty` | "[field] is required" |
{% endif %}

---
{% endblock %}

{% block data_operations %}## Data Operations

**Purpose:** Document all database interactions to support impact analysis, debugging, and performance optimization.

### Reads From

{% if data_reads %}
| Database Object | Method | Purpose | Performance Notes |
|-----------------|--------|---------|-------------------|
{% for read in data_reads %}
| `{{ read.table_name }}` | `{{ read.method_name }}()` | Fetch data for operations | ğŸ¤– [AI: Query pattern & optimization hints] |
{% endfor %}
{% else %}
| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| `[schema.TableName]` | ğŸ¤– [AI: What read, which columns] | [HUMAN: Why needed?] | ğŸ¤– [AI: Query pattern] |
{% endif %}

### Writes To

{% if data_writes %}
| Database Object | Method | Operation | Atomic? |
|-----------------|--------|-----------|---------|
{% for write in data_writes %}
| `{{ write.table_name }}` | `{{ write.method_name }}()` | {{ write.operation_type }} | âœ… Yes |
{% endfor %}
{% else %}
| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| `[schema.TableName]` | ğŸ¤– [AI: What write, which columns] | [HUMAN: Why needed?] | ğŸ¤– [AI: Transaction scope] |
{% endif %}

---

{% endblock %}

{% block failure_modes %}## Failure Modes & Exception Handling (PHASE 10.2)

**Purpose:** Document exception handling patterns, error flows, and business impact of failures.

### Common Failure Scenarios

{% if failure_modes and failure_modes | length > 0 %}
| Exception Type | Trigger | Operation | Impact | Mitigation |
|---|---|---|---|---|
{% for fm in failure_modes %}
| `{{ fm.exception_type }}` | {{ fm.trigger }} | {{ fm.operation }} | {{ fm.impact }} | {{ fm.mitigation }} |
{% endfor %}

{% else %}
| Exception Type | Trigger | Operation | Impact | Mitigation |
|---|---|---|---|---|
| ğŸ¤– `InvalidOperationException` | ğŸ¤– [What causes it] | ğŸ¤– [Which operation fails] | ğŸ¤– [Business consequence] | ğŸ¤– [How service handles it] |
| ğŸ¤– `DbUpdateException` | ğŸ¤– [DB constraint violated] | ğŸ¤– [Which write operation fails] | ğŸ¤– [Data not persisted] | ğŸ¤– [Retry? Rollback? User message?] |
| ğŸ¤– `TimeoutException` | ğŸ¤– [Slow query/API call] | ğŸ¤– [Operation hangs] | ğŸ¤– [User request times out] | ğŸ¤– [Retry logic? Circuit breaker?] |
{% endif %}

### Expected vs Unexpected Failures

**Expected Failures** (Service recovers, user informed):
- Validation errors (400 BadRequest) â†’ User corrects input and retries
- Resource not found (404 NotFound) â†’ User checks resource ID and retries
- Duplicate key (409 Conflict) â†’ User knows this is a business rule violation; takes corrective action
- Rate limit exceeded (429 TooManyRequests) â†’ Client backs off and retries per spec

**Unexpected Failures** (Service degrades, incident alerting triggered):
- Database unavailable (500 InternalServerError) â†’ Service down; on-call notified
- External API timeout (504 GatewayTimeout) â†’ External system issue; fallback or queue for retry
- Memory exception (OutOfMemoryException) â†’ Service crash; restart may be needed
- Configuration error (null reference in initialization) â†’ Deployment issue; rollback needed

---

{% endblock %}

{% block questions_and_gaps %}## Questions & Gaps

â“ **[HUMAN: Add open questions]**  
What needs clarification or further investigation?

### Known Gaps
- ğŸ¤– **[What's not implemented yet?]**
- ğŸ¤– **[What's unclear about the design?]**

### Assumptions
- ğŸ¤– **[What are we assuming about external systems?]**

---
{% endblock %}

{% block testing %}## Testing Strategy

ğŸ¤– **[AI: How should this service be tested? Unit tests? Integration tests? Key scenarios?]**

### Key Test Scenarios

- âœ… Happy path: Valid input â†’ Success response
- âŒ Validation failure: Invalid input â†’ 400 BadRequest
- âŒ Conflict: Duplicate resource â†’ 409 Conflict
- âŒ Not found: Resource missing â†’ 404 NotFound
- âŒ Database error: Persistence fails â†’ 500 InternalServerError

---
{% endblock %}

{% block known_issues %}## Known Issues & Limitations

ğŸ¤– **[AI: Document any known issues, temporary workarounds, or architectural limitations]**

---
{% endblock %}

{% block future_improvements %}## Future Improvements

ğŸ¤– **[AI: What improvements or refactorings would enhance this service?]**

---
{% endblock %}

{% block related_services %}## Related Services

ğŸ¤– **[AI: What other services does this service interact with? How?]**

| Service | Interaction Type | Purpose |
|---------|-----------------|---------|
| | | |

---
{% endblock %}

{% block source_files_footer %}**Source Files Analyzed**: 
{% if source_files %}
{% for file in source_files %}
- `{{ file }}`
{% endfor %}
{% else %}
- [Source files listed here]
{% endif %}

*This documentation was auto-generated from extracted code. All ğŸ¤– sections and â“ placeholders require human review and completion.*
{% endblock %}

---
feature: [FEATURE_NAME]
domain: [DOMAIN]
layer: API
component: [SERVICE_NAME]
status: deployed
version: 1.0
componentType: Service
priority: P1
lastUpdated: [YYYY-MM-DD]
---

# Service: [SERVICE_NAME]

**Namespace/Project**: [Project.Services]  
**File Location**: `src/Services/[ServiceName].cs`   
**Complexity**: [Simple / Medium / Complex]  
**Documentation Level**: üî∂ Baseline (70% complete)

---

## Quick Reference (TL;DR)

**What it does:**  
ü§ñ [AI: 1-2 sentences on what service accomplishes]  
‚ùì [HUMAN: Add business value - why does this service exist?]

**When to use it:**  
‚ùì [HUMAN: What scenarios trigger use of this service? Web UI? API? Background jobs?]

**Watch out for:**  
‚ùì [HUMAN: Critical gotcha or common mistake when using this service]

---

## What & Why

### Purpose

ü§ñ [AI: Technical description of what service does]

‚ùì [HUMAN: Business purpose - what problem does this solve? Why did we build it?]

### Capabilities

ü§ñ [AI: Bullet list of what service can do]

**Example:**
- Enroll users in courses with prerequisite validation
- Check enrollment eligibility based on business rules
- Send enrollment confirmation emails
- Track enrollment history

### Not Responsible For

ü§ñ [AI: What this service explicitly does NOT do]  
‚ùì [HUMAN: Clarify scope boundaries - what's handled elsewhere?]

**Example:**
- Does NOT handle payment processing (handled by PaymentService)
- Does NOT validate user authentication (handled by AuthService)
- Does NOT manage course catalog (handled by CourseService)

---

## How It Works

### Primary Operation: [Main Method Name]

**Purpose:**  
ü§ñ [AI: What this method accomplishes]  
‚ùì [HUMAN: Business context - why do we need this operation?]

**Input:**  
ü§ñ [AI: Parameters and types]

**Output:**  
ü§ñ [AI: Return type and success/failure scenarios]

**Step-by-Step Flow:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Step 1: [Action]                                             ‚îÇ
‚îÇ  What  ‚Üí ü§ñ [AI: Technical action taken]                     ‚îÇ
‚îÇ  Why   ‚Üí ‚ùì [HUMAN: Business reason for this step]           ‚îÇ
‚îÇ  Error ‚Üí ü§ñ [AI: What errors can occur]                      ‚îÇ
‚îÇ         ‚ùì [HUMAN: Business impact of error]                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Step 2: [Action]                                             ‚îÇ
‚îÇ  What  ‚Üí ü§ñ [AI: Technical action taken]                     ‚îÇ
‚îÇ  Why   ‚Üí ‚ùì [HUMAN: Business reason for this step]           ‚îÇ
‚îÇ  Error ‚Üí ü§ñ [AI: What errors can occur]                      ‚îÇ
‚îÇ         ‚ùì [HUMAN: Business impact of error]                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Step 3: [Action]                                             ‚îÇ
‚îÇ  What  ‚Üí ü§ñ [AI: Technical action taken]                     ‚îÇ
‚îÇ  Why   ‚Üí ‚ùì [HUMAN: Business reason for this step]           ‚îÇ
‚îÇ  Error ‚Üí ü§ñ [AI: What errors can occur]                      ‚îÇ
‚îÇ         ‚ùì [HUMAN: Business impact of error]                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
                    [SUCCESS] or [FAILURE]
```

**Success Path:**  
ü§ñ [AI: What happens on successful completion]

**Failure Paths:**  
ü§ñ [AI: What errors can occur and when]  
‚ùì [HUMAN: Business implications of each failure]

---

## Business Rules

[Table of business rules enforced by this service]

| Rule ID | Description | Why It Exists | Since When | Violation Exception |
|---------|-------------|---------------|------------|---|
| ü§ñ **BR-[SVC]-001** | ü§ñ [AI: Rule description from code] | ‚ùì [HUMAN: Business rationale] | ‚ùì [HUMAN: When added] | ü§ñ [AI: Exception type thrown - PHASE 10.2] |
| ü§ñ **BR-[SVC]-002** | ü§ñ [AI: Rule description from code] | ‚ùì [HUMAN: Business rationale] | ‚ùì [HUMAN: When added] | ü§ñ [AI: Exception type thrown - PHASE 10.2] |
| ü§ñ **BR-[SVC]-003** | ü§ñ [AI: Rule description from code] | ‚ùì [HUMAN: Business rationale] | ‚ùì [HUMAN: When added] | ü§ñ [AI: Exception type thrown - PHASE 10.2] |

**Rule ID Format:** BR-[ServiceAbbreviation]-### (e.g., BR-ENR-001 for EnrollmentService)

**Exception Mapping (PHASE 10.2):**  
See "Failure Modes & Exception Handling" section for details on what exceptions are thrown when these rules are violated.

**Common Questions:**
- ‚ùì [HUMAN: Any rules that seem arbitrary? Document the history.]
- ‚ùì [HUMAN: Any rules that changed recently? Document why.]

---

## Architecture

### Where This Fits

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Layer          ‚îÇ  ü§ñ [AI: Controller name]
‚îÇ   (Entry Point)      ‚îÇ  ‚Üí See API Reference Database:
‚îÇ                      ‚îÇ     [Link to API docs]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ‚ñ∫ THIS SERVICE ‚óÑ   ‚îÇ  [ServiceName]
‚îÇ   (Business Logic)   ‚îÇ  ü§ñ [AI: Purpose]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Data Layer         ‚îÇ  ü§ñ [AI: Repository name]
‚îÇ   (Database Access)  ‚îÇ  ‚Üí Operates on: [Table names]
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Dependencies (What This Service Needs)

| Dependency | Purpose | Failure Mode | Critical? |
|------------|---------|--------------|-----------|
| ü§ñ `IDependencyName` | ü§ñ [AI: What it's used for] | ü§ñ [AI: What exception/failure occurs - PHASE 10.2] | ‚ùì [HUMAN: Blocking? Can service degrade?] |
| ü§ñ `IDependencyName` | ü§ñ [AI: What it's used for] | ü§ñ [AI: Exception + business impact] | ‚ùì [HUMAN: Fallback available?] |

**Example (PHASE 10.2 Enhanced):**
| Dependency | Purpose | Failure Mode | Critical? |
|------------|---------|--------------|-----------|
| `ICourseRepository` | CRUD operations + title uniqueness checks | `DbUpdateException`: Constraint violation when duplicate title | ‚ö†Ô∏è **Blocking** - course operations cannot proceed without data access |
| `ILogger` | Request/error logging | `NullReferenceException` if no logger injected | Non-critical - logging failures don't block operations |

### Consumers (Who Uses This Service)

| Consumer | Use Case | Impact of Failure |
|----------|----------|-------------------|
| ü§ñ [Controller/Service name] | ü§ñ [AI: How they use it] | ‚ùì [HUMAN: User-facing? Background?] |
| ü§ñ [Controller/Service name] | ü§ñ [AI: How they use it] | ‚ùì [HUMAN: What breaks if this fails?] |

---

## API Contract (AI Context)

> üìã **Interactive Documentation:** [API Portal - ServiceName](https://apim.gateway.emerson.com/...) ‚Äî use for testing
> 
> **Purpose:** This section provides AI assistants (Copilot) with API context.
> **Sync Status:** Last verified on ‚ùì [HUMAN: Date]

### Endpoints

ü§ñ [AI: Extract from ApiRoutes.cs and controller [Http*] attributes]

| Method | Route | Purpose | Auth |
|--------|-------|---------|------|
| ü§ñ `GET` | ü§ñ `/v1/[resource]` | ü§ñ Get all | ü§ñ Yes |
| ü§ñ `GET` | ü§ñ `/v1/[resource]/{id}` | ü§ñ Get by ID | ü§ñ Yes |
| ü§ñ `POST` | ü§ñ `/v1/[resource]` | ü§ñ Create | ü§ñ Yes |
| ü§ñ `PUT` | ü§ñ `/v1/[resource]/{id}` | ü§ñ Update | ü§ñ Yes |
| ü§ñ `DELETE` | ü§ñ `/v1/[resource]/{id}` | ü§ñ Delete | ü§ñ Yes |

### Request Example

ü§ñ [AI: Generate realistic examples from DTOs, reflecting actual business domain - PHASE 10.2]

```json
{
  "propertyName": "ü§ñ [AI: Realistic value based on property domain semantics]",
  "propertyId": "ü§ñ [AI: Smart value, respecting type and constraints]",
  "isActive": true
}
```

**Example (Real CourseService Request):**
```json
{
  "title": "Safety Orientation",
  "isRequired": true,
  "isActive": true,
  "validityMonths": 12,
  "category": "Safety",
  "description": "Mandatory safety training covering workplace hazards and emergency procedures"
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| ü§ñ `propertyName` | ü§ñ `string` | ü§ñ Yes | ü§ñ [AI: Business purpose of field] |
| ü§ñ `propertyId` | ü§ñ `int` | ü§ñ Yes | ü§ñ [AI: Business purpose of field] |
| ü§ñ `isActive` | ü§ñ `bool` | ü§ñ No | ü§ñ [AI: Default behavior and purpose] |

### Success Response Example (200)

ü§ñ [AI: Generate from response DTO]

```json
{
  "id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
  "propertyName": "value",
  "createdDate": "2024-01-01T00:00:00Z"
}
```

### Error Response Example

ü§ñ [AI: Extract from error model classes]

```json
{
  "statusCode": 400,
  "message": "Validation failed.",
  "validationErrors": [
    { "fieldName": "propertyName", "message": "Required" }
  ]
}
```

‚ùì [HUMAN: Keep synchronized with API Portal when endpoints change]

---

## Validation Rules (AUTO-GENERATED)

ü§ñ [AI: Extract from *Validator.cs FluentValidation classes]

| Property | Rule | Error Message |
|----------|------|---------------|
| ü§ñ `[Property]` | ü§ñ `NotEmpty()` | ü§ñ "[Property] is required" |
| ü§ñ `[Property]` | ü§ñ `MaximumLength(N)` | ü§ñ "Cannot exceed N characters" |
| ü§ñ `[Property]` | ü§ñ `GreaterThan(0)` | ü§ñ "Must be greater than 0" |

‚ùì [HUMAN: Add business rationale for non-obvious validation rules]

---

## Data Operations

**Purpose:** Document all database interactions for impact analysis, performance optimization, and tracing service behavior to data layer.

### Reads From

| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `schema.TableName` | ü§ñ [AI: What data retrieved, which columns] | ‚ùì [HUMAN: Why needed? Business rule context] | ü§ñ [AI: Query pattern, indexes, optimization hints] |
| ü§ñ `schema.ViewName` | ü§ñ [AI: What aggregated data used] | ‚ùì [HUMAN: Why use view vs raw tables?] | ü§ñ [AI: View query plan, materialized?] |

**AI GENERATION HINT (PHASE 10.2):** Analyze repository code for:
- `SELECT` statements and `DbSet<T>` queries
- `.Where()`, `.OrderBy()`, `.Include()` patterns  
- Output SQL: "Query: `SELECT * FROM Table WHERE Id = @id`"
- Index needs: "‚ö†Ô∏è Consider index on CourseId field"
- N+1 risks: "Each course fetch triggers separate category query"

**Example:**
| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `training.Courses` | ü§ñ Validate course exists before enrollment (SELECT Id, IsActive) | ‚ùì Prevent orphaned enrollments, business rule requirement | ü§ñ Query: `SELECT Id WHERE Id = @courseId` ‚ö†Ô∏è Add index on IsActive |
| ü§ñ `training.Prerequisites` | ü§ñ Check if user completed required courses (SELECT CourseId) | ‚ùì State licensing requirement (Regulation 45.301) | ‚ö†Ô∏è N+1 query risk - consider JOIN optimization |

**Cross-Repository Reference:**  
For table schema details, see [Table Documentation](../../database-repo/docs/tables/)

---

### Writes To

| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `schema.TableName` | ü§ñ [AI: INSERT/UPDATE/DELETE operation, which columns] | ‚ùì [HUMAN: What business event triggers this? Why persist?] | ü§ñ [AI: Transaction scope if visible] ‚ùì [HUMAN: High volume? Indexing needs?] |

**Example:**
| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `training.Enrollments` | ü§ñ INSERT new enrollment record (UserId, CourseId, EnrolledDate, Status) | ‚ùì Core business entity, triggers downstream notifications and access grants | ü§ñ Transaction: Part of unit of work with AuditLog ‚ö†Ô∏è High volume during registration periods |
| ü§ñ `training.AuditLog` | ü§ñ INSERT audit entry (Action, UserId, Timestamp, Details) | ‚ùì Compliance requirement for SOX/GDPR auditing | ‚ö†Ô∏è High volume - consider async logging or separate database |

---

### Calls (Stored Procedures / Functions)

| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `usp_ProcedureName` | ü§ñ [AI: What complex operation, input/output parameters] | ‚ùì [HUMAN: Why stored proc vs service logic? Business rules too complex?] | ‚ùì [HUMAN: Execution time, timeout concerns] |

**Example:**
| Database Object | Purpose | Business Context | Performance Notes |
|-----------------|---------|------------------|-------------------|
| ü§ñ `usp_ValidatePrerequisites` | ü§ñ Complex prerequisite validation logic (input: UserId, CourseId; output: IsValid, MissingPrereqs) | ‚ùì Business rules too complex for service layer, shared across multiple applications | ‚ö†Ô∏è 200ms avg execution - monitor timeout, consider caching results |

---

### Side Effects

| Database Object | Trigger/Effect | Business Context | Impact |
|-----------------|----------------|------------------|--------|
| ü§ñ [AI: Table with trigger, or external system call] | ü§ñ [AI: What happens automatically] | ‚ùì [HUMAN: Why this side effect exists? Business requirement?] | ‚ùì [HUMAN: Blocking? Async? Failure handling?] |

**Example:**
| Database Object | Trigger/Effect | Business Context | Impact |
|-----------------|----------------|------------------|--------|
| ü§ñ `training.Enrollments` (INSERT trigger) | ü§ñ Sends email notification via Service Broker queue | ‚ùì Immediate notification requirement for user experience | ‚ö†Ô∏è Email failure doesn't rollback transaction - acceptable trade-off |
| ü§ñ External: Email service API call | ü§ñ Sends confirmation email after enrollment created | ‚ùì User expects immediate confirmation per UX requirements | ‚ö†Ô∏è Timeout after 5 seconds, enrollment succeeds even if email fails |

---

## Failure Modes & Exception Handling (PHASE 10.2)

**Purpose:** Document exception handling patterns, error flows, and business impact of failures. Help on-call engineers quickly understand "what could go wrong and what happens next."

### Common Failure Scenarios

ü§ñ [AI: Extracted from exception handling in source code - PHASE 10.2]

| Exception Type | Trigger | Operation | Impact | Mitigation |
|---|---|---|---|---|
| ü§ñ `InvalidOperationException` | ü§ñ [What causes it] | ü§ñ [Which operation fails] | ü§ñ [Business consequence] | ü§ñ [How service handles it] |
| ü§ñ `ArgumentNullException` | ü§ñ [What causes it] | ü§ñ [Which operation fails] | ü§ñ [Business consequence] | ü§ñ [How service handles it] |
| ü§ñ `DbUpdateException` | ü§ñ [DB constraint violated] | ü§ñ [Which write operation fails] | ü§ñ [Data not persisted] | ü§ñ [Retry? Rollback? User message?] |
| ü§ñ `TimeoutException` | ü§ñ [Slow query/API call] | ü§ñ [Operation hangs] | ü§ñ [User request times out] | ü§ñ [Retry logic? Circuit breaker?] |

### Expected vs Unexpected Failures

**Expected Failures** (Service recovers, user informed):
- Validation errors (400 BadRequest) ‚Üí User corrects input and retries
- Resource not found (404 NotFound) ‚Üí User checks resource ID and retries
- Duplicate key (409 Conflict) ‚Üí User knows this is a business rule violation; takes corrective action
- Rate limit exceeded (429 TooManyRequests) ‚Üí Client backs off and retries per spec

**Unexpected Failures** (Service degrades, incident alerting triggered):
- Database unavailable (500 InternalServerError) ‚Üí Service down; on-call notified
- External API timeout (504 GatewayTimeout) ‚Üí External system issue; fallback or queue for retry
- Memory exception (OutOfMemoryException) ‚Üí Service crash; restart may be needed
- Configuration error (null reference in initialization) ‚Üí Deployment issue; rollback needed

---

## Questions & Gaps

### AI-Flagged Questions

ü§ñ [AI will identify unclear logic, magic numbers, assumptions]

**Example:**
- ü§ñ Magic number "3" in validation - purpose unclear
- ü§ñ Hardcoded timeout value - should be configurable?
- ü§ñ Comment says "temporary workaround" - what's the permanent fix?

### Human-Flagged Questions

‚ùì [HUMAN: Add questions you have while reviewing]

**Example:**
- ‚ùì Why does prerequisite validation happen twice?
- ‚ùì Who decided the 3-enrollment limit and why?
- ‚ùì Should we notify admin when enrollment fails?

### Next Steps

- [ ] ‚ùì [HUMAN: Follow-up actions needed]
- [ ] ‚ùì [HUMAN: People to ask for clarification]
- [ ] ‚ùì [HUMAN: Documentation to reference]

---

## Optional Sections (Add When Needed)

The sections below are **OPTIONAL**. Add them only when you have real information to share:

### Alternative Paths (Add When: Complex conditional logic)

[Document alternative flows beyond primary operation]

### Performance (Add When: Production metrics available)

[Document response times, bottlenecks, optimization notes]

### Known Issues & Limitations (Add When: Bugs or workarounds exist)

[Document current limitations, technical debt, workarounds]

### External Dependencies (Add When: Third-party integrations)

[Document external systems, APIs, failure behavior]

### Common Problems & Solutions (Add When: Support tickets occur)

[Document recurring issues and how to resolve them]

### What Could Break (Add When: Planning major changes)

[Document downstream impacts of changing this service]

---

## Maintenance Checklist

**When making code changes to this service:**

- [ ] Update this documentation if behavior changes
- [ ] Update business rules table if validation logic changes
- [ ] Update flow diagram if steps added/removed
- [ ] Update error reference if new errors introduced
- [ ] Add to "Known Issues" if introducing limitation
- [ ] Update "Questions & Gaps" if answering previous questions

---

## Documentation Standards

This template follows the **Lean Baseline Service Documentation** approach:
- 70% generated by AI (Copilot/ChatGPT) - marked with ü§ñ
- 30% human-enhanced business context - marked with ‚ùì
- Baseline sections required (~20-25 minutes)
- Optional sections added when triggered by events

**Baseline Sections (Required):**
- Quick Reference, What & Why, How It Works, Business Rules
- Architecture, Data Operations, Questions & Gaps

**Optional Sections (Add Later):**
- Alternative Paths, Performance, Known Issues, External Dependencies
- Common Problems, What Could Break

See `Backend_Service_Documentation_Guide.md` for complete implementation guide.

---

## AI Generation Instructions

**For AI (Copilot/ChatGPT):**

When generating this documentation:
1. Mark all AI-generated content with ü§ñ
2. Mark sections needing human input with ‚ùì
3. Extract method signatures, parameters, return types from code
4. Identify dependencies from constructor injection
5. List database tables from repository calls
6. Extract validation logic for business rules
7. Flag magic numbers, hardcoded values, unclear logic
8. Create text-based flow diagram (NOT Mermaid)
9. Focus on WHAT code does (observable behavior)
10. Flag WHY questions for human input (cannot infer business context)

**Additional API Contract Extraction Rules:**

11. **Extract API routes:**
    - Find static route classes (`ApiRoutes.cs`, `Routes.cs`)
    - Parse `public static string` and `public const string` properties
    - Resolve route constant references in `[Http*()]` attributes

12. **Map routes to controllers:**
    - Match `[HttpGet(ApiRoutes.X.Y)]` to resolved string value
    - Extract `[Authorize]` vs `[AllowAnonymous]` attributes

13. **Extract error models:**
    - Scan Models folder for `*Error*`, `*Exception*`, `*Details` patterns
    - Include all public properties with types

14. **Parse HTTP status codes:**
    - Find `return Ok()`, `return NotFound()`, `return BadRequest()` patterns
    - Map to standard HTTP status codes

15. **Extract validation rules:**
    - Find FluentValidation `*Validator.cs` classes
    - Parse `RuleFor(x => x.Property)` chains
    - Extract rule types and `.WithMessage()` content

16. **Generate JSON examples:**
    - Create sample JSON from model properties
    - Use sensible defaults: `string` ‚Üí `"string"`, `int` ‚Üí `0`, `Guid` ‚Üí `"guid"`, `bool` ‚Üí `true`

**For Humans:**

After AI generates baseline:
1. Add business context to "Why" fields (5 min)
2. Complete business rules "Why It Exists" column (5 min)
3. Add failure modes to dependencies (3 min)
4. Complete Quick Reference usage scenarios (3 min)
5. Answer Questions & Gaps items you can (2 min)
6. Review flow diagram for accuracy (2 min)

**Total Time:** 20-25 minutes

---

## Documentation Standards

### This template follows the Application Knowledge Repo (AKR) system

**For universal conventions, see**:
- **AKR_CHARTER.md** - Core principles, generic data types, feature tags, Git format
  - Why we document (lean, flexible, evolutionary)
  - Universal conventions (all documentation types)
  - Documentation tiers (Essential/Recommended/Optional)
  - Tool integration (LLM assistance, Git workflows)

**For backend service-specific conventions, see**:
- **AKR_CHARTER_BACKEND.md** - Service layer naming, documentation patterns, enterprise best practices
  - Service naming conventions (classes, methods, files)
  - Service documentation structure (baseline vs optional sections)
  - Business rules format (BR-[SVC]-### convention)
  - Flow diagram patterns (text-based boxes with What/Why/Error/Impact)
  - Dependencies and consumers documentation
  - Data operations patterns
  - Enterprise best practices (separation of concerns, DI, async/await, transactions, logging, validation)
  - AI-assisted workflow (Human/AI responsibility split)
  - Common anti-patterns to avoid

**For team-specific requirements, see**:
- **OUR_STANDARDS.md** (if exists in your project)
  - Team-specific required sections
  - Team-specific formats
  - Validation rules
  - Custom conventions

---

## Minimum Viable Documentation

**Essential sections** (must include):
- Service identification (name, namespace, file location, last updated)
- Quick Reference (what it does, when to use, watch out for)
- What & Why (purpose, capabilities, scope boundaries)
- Primary Operation (main method flow with inputs/outputs)

**That's it!** Everything else is recommended or optional.

Start lean, add detail as knowledge accumulates.

---

## Recommended Sections (Include When Applicable)

Add these sections when the information is relevant:
- Business Rules (if validation/business logic exists)
- Architecture (if dependencies or consumers are important)
- Data Operations (if database interactions exist)
- Questions & Gaps (flag unknowns for future clarification)

---

## Optional Sections (Add When Valuable)

The sections below are optional. Add them when you have real information to share, not on Day 1 with placeholder text:

### Alternative Paths
[Document when: Service has complex conditional logic, multiple workflows]

### Performance Considerations
[Document when: Production metrics available, bottlenecks identified]

### Known Issues & Limitations
[Document when: Bugs discovered, workarounds implemented, technical debt exists]

### External Dependencies
[Document when: Third-party API integrations, external systems]

### Common Problems & Solutions
[Document when: Support tickets, production incidents, recurring issues]

### What Could Break
[Document when: Planning major refactoring, assessing downstream impact]

### Security & Authorization
[Document when: Special security requirements, sensitive data handling]

### Testing Guidance
[Document when: Complex test setup, integration test patterns needed]

**Remember**: Add optional sections when they help the team, not because a template suggests them.

---

## Related Documentation

**API Endpoints:** See API Reference Database: [Link to your API docs system]  
**Database Tables:** See database documentation:
- Cross-repository format: `[Table Name](../../database-repo/docs/tables/TableName_doc.md)`
- Same repository format: `[Table Name](../database/tables/TableName_doc.md)`

**Related Services:** Link to dependent/consumer service docs:
- `[ServiceName](./ServiceName_doc.md)`

---

## Change History

**Service evolution is tracked in Git**, not in this document.

To see how this service evolved:
```bash
# View all changes to this documentation file
git log docs/services/[ServiceName]_doc.md

# View changes with diffs
git log -p docs/services/[ServiceName]_doc.md

# Search for specific business rule or feature
git log --grep="BR-[SVC]" docs/services/[ServiceName]_doc.md
git log --grep="FN#####" docs/services/[ServiceName]_doc.md
```

**Include feature tags in commit messages** to link documentation changes to work items:
```bash
git commit -m "docs: update [ServiceName] - add prerequisite validation (FN12345_US067)"
```

See AKR_CHARTER.md for complete Git conventions.

---

## How to Use This Template

### Step 1: Generate Initial Structure

**Option A: Using Copilot** (GitHub Copilot, recommended)
```
Open Copilot Chat (Ctrl+Shift+I):

"Follow AKR_CHARTER.md and AKR_CHARTER_BACKEND.md conventions.
Use this template at lean_baseline_service_template.md to generate 
documentation for the following service:

[Attach service file, repository files, related DTOs]

Include ONLY baseline sections (skip optional sections):
- Service Identification
- Quick Reference (TL;DR)
- What & Why
- Primary Operation (with text-based flow diagram)
- Business Rules (table with Why It Exists column)
- Architecture (Dependencies and Consumers)
- Data Operations (Reads, Writes, Side Effects)
- Questions & Gaps

Mark AI-generated content with ü§ñ
Mark sections needing human input with ‚ùì
Use text-based flow diagrams (NOT Mermaid)
Focus on WHAT code does (AI extracts from code)
Flag WHY questions for human input (business context)"
```

**Option B: Using ChatGPT/Claude**
- Copy service file content
- Paste prompt similar to above
- Include references to AKR charters
- Copy generated documentation to template

**Option C: Manual** (not recommended for baseline - too time-consuming)
- Copy template
- Fill in each section manually
- Use template structure as guide

### Step 2: Review and Enhance

After AI generates baseline documentation:

**Human enhancement (20-25 minutes):**
- [ ] Add business context to "Why" fields (5 min)
  - Why does this service exist?
  - What business problem does it solve?
- [ ] Complete business rules "Why It Exists" column (5 min)
  - Business rationale for each rule
  - Regulatory requirements if applicable
- [ ] Add failure modes to dependencies (3 min)
  - Critical vs non-critical dependencies
  - What happens if dependency unavailable
- [ ] Complete Quick Reference usage scenarios (3 min)
  - When to use this service
  - Common mistakes/gotchas
- [ ] Answer Questions & Gaps items you can (2 min)
  - Remove answered questions
  - Add new questions you discover
- [ ] Review flow diagram for accuracy (2 min)
  - Verify technical steps correct
  - Add business context to Why fields

**Total Time:** 20-25 minutes for production-ready baseline

### Step 3: Submit for Review

```bash
git add docs/services/[ServiceName]_doc.md
git commit -m "docs: add [ServiceName] baseline documentation (FN#####_US#####)

- Generated baseline using Copilot
- Enhanced with business context
- Documented business rules with rationale
- Identified dependencies and consumers
"
# Create PR, request Tech Lead review
```

### Step 4: Tech Lead Review

**Tech Leads evaluate**:
- ‚úÖ Is this useful for the team?
- ‚úÖ Is the content accurate?
- ‚úÖ Is business context included (WHY, not just WHAT)?
- ‚úÖ Are business rules documented with rationale?
- ‚úÖ Does it follow AKR conventions?

**Not evaluated**: Perfect grammar, exact template match, exhaustive detail

**Acceptance criteria**: Documentation helps developers understand service without reading all code.

---

## Quick Reference for Service Documentation

### Required Conventions (from AKR Charters)

**Service Naming** (see AKR_CHARTER_BACKEND.md):
- Class: `[Entity]Service` or `[Capability]Service`
- Methods: `Verb[Entity][Qualifier]` (e.g., `EnrollUserInCourse`, `GetActiveCourses`)
- Async: Suffix with `Async` (C#) or use `async` keyword (JS/TS/Python)

**Business Rules Format** (see AKR_CHARTER_BACKEND.md):
- Format: `BR-[ServiceAbbreviation]-###: Rule description`
- Example: `BR-ENR-001: Users cannot enroll in same course twice`
- Always include "Why It Exists" column (business rationale)

**Feature Tag Format** (see AKR_CHARTER.md):
- Format: `FN#####_US#####`
- Use in commit messages

**Flow Diagrams** (see AKR_CHARTER_BACKEND.md):
- Text-based boxes (NOT Mermaid)
- Include: What (technical), Why (business), Error (exceptions), Impact (consequence)

**AI/Human Markers**:
- ü§ñ = AI-generated content (WHAT code does)
- ‚ùì = Needs human input (WHY decisions, business context)

### Time Estimates

- **AI generation**: 5-7 minutes
- **Human enhancement**: 18-20 minutes
- **Total baseline**: ~25 minutes
- **Optional section**: +10-15 minutes each (add later when triggered)

### Getting Help

**Questions about template?**
- Check AKR_CHARTER.md for principles
- Check AKR_CHARTER_BACKEND.md for service patterns
- Check Backend_Service_Documentation_Guide.md for detailed workflow
- Check OUR_STANDARDS.md for team specifics
- Ask Tech Lead or team channel

**AI generated wrong info?**
- Normal - LLMs hallucinate. Review and correct.
- Focus on structure + inferred content, you add accuracy + business context

**Service too complex for baseline?**
- Start with baseline (70% complete)
- Add optional sections incrementally
- Don't try to document everything upfront
- Document what you know now, expand as you learn

---

## Template Metadata

**Template Version**: Lean Baseline v1.0  
**Last Updated**: 2025-10-31  
**Maintained By**: Architecture Team  
**Part of**: Application Knowledge Repo (AKR) system

**Time to Complete**: 20-25 minutes (with AI assistance)  
**Best For**: 80% of services, legacy documentation, sustainable at scale  
**Documentation Level**: üî∂ 70% complete baseline (production-ready)

**Previous Version**: N/A (initial version)  
**Key Philosophy**: AI generates structure (WHAT), humans add context (WHY)

---

**Pro tip:** Focus on capturing business context (WHY), not rehashing code (WHAT). The code already says WHAT it does - documentation should explain WHY it does it that way.
